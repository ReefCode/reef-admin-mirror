import{j as e,L as j,B as b}from"./Loading.Dw76dUgN.js";import{q as w}from"./index.DTLz-HeY.js";import{p as v,a as l}from"./index.BBp7o1b3.js";import{F as a,I as n}from"./Form.D2qAwbVm.js";import{r as O}from"./index.24z1lnX0.js";import{B as r}from"./_astro-entry_react-toastify.CDZtbDrs.js";import"./index.D82GmqbV.js";import"./clsx.B-dksMZM.js";const u=v("role","",{encode:JSON.stringify,decode:JSON.parse}),I=({apiUrl:c,apiToken:p})=>{const[d,s]=O.useState(!1),m=async i=>{s(!0);const g=i.email,f=i.password,h={populate:{avatar:{populate:"*"},background:{populate:"*"},brand:{populate:"*"},services:{populate:"*"},role:{populate:"*"}}},x=w.stringify(h),y=`${c}/api/auth/local?${x}`;try{const t=await fetch(`${y}`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`bearer ${p}`},body:JSON.stringify({identifier:g,password:f})});if(t.ok){const o=await t.json();o.jwt&&(o?.user?.isAdmin?(l.set("reef_token",o.jwt),u.set("admin"),setTimeout(()=>{r.success("Login as admin successfullyðŸ˜Ž",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),setTimeout(()=>{s(!1),location.href="/"},1500)},1e3)):(u.set("employee"),r.success("ðŸ‘Œ Login successful!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),o?.user.approvedAsEmployee?(l.set("reef_token",o.jwt),setTimeout(()=>{r.success("Allowed your account by admin",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),setTimeout(()=>{s(!1),location.href="/"},1500)},1e3)):(console.log("Login successful"),setTimeout(()=>{r.info("Not allowed by admin yet",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),setTimeout(()=>{s(!1)},1500)},1e3))))}else console.error("Not registered user"),r.error("ðŸ˜¢ Not registered user",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),s(!1)}catch(t){console.error("Error occurred during login:",t)}};return e.jsxs(e.Fragment,{children:[d&&e.jsx(j,{}),e.jsx("div",{className:"max-w-[500px] w-full mx-auto min-h-screen flex items-center justify-center",children:e.jsxs(a,{className:"border p-10 rounded-xl shadow-2xl w-full",name:"basic",layout:"vertical",autoComplete:"off",onFinish:m,children:[e.jsx("h3",{className:"text-3xl font-bold mb-6",children:"Sign In"}),e.jsx(a.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email!"}],children:e.jsx(n,{})}),e.jsx(a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{required:!0,message:"Please input more than 6 characters",min:6}],children:e.jsx(n.Password,{})}),e.jsxs("div",{className:"mb-5",children:["Don't have an account?"," ",e.jsx("a",{href:"/signup",className:"font-semibold text-primary",children:"Register today"})]}),e.jsx(a.Item,{className:"mb-0",children:e.jsx(b,{type:"primary",htmlType:"submit",children:"Login"})})]})})]})};export{I as default};
